{% extends "./base.html" %}

{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'game/css/play.css' %}" />
{% endblock %}
{% block js %}
    <script src="{% static 'game/js/city-row.directive.js' %}"></script>
    <script src="{% static 'game/js/game.controller.js' %}"></script>
{% endblock %}

{% block content %}
    <div ng-controller="GameController as gameCtrl" ng-init="gameCtrl.startGame({{ campaign.id }})">
        <div class="game" ng-show="gameCtrl.campaignId">
            {# Deck sections #}
            <div class="game__column">
                <div ng-repeat="deckSection in gameCtrl.deck"
                     class="city-group">
                    <city-row ng-repeat="city in deckSection" city="city"
                              ng-click="gameCtrl.playCityCard($parent.$index, $index)"></city-row>
                </div>
            </div>

            {# Discard Pile #}
            <div class="game__column">
                <button ng-click="gameCtrl.openEpidemicModal()">Trigger Epidemic</button>
                <div class="city-group">
                    <city-row ng-repeat="city in gameCtrl.discardPile" city="city"></city-row>
                </div>
            </div>
        </div>

        {# Epidemic #}
        <div class="epidemic" ng-class="{'in': gameCtrl.showEpidemicModal}">
            <div class="epidemic__close" ng-click="gameCtrl.closeEpidemicModal()">&times;</div>
            <div class="epidemic__title">Epidemic!</div>
            <form class="epidemic__search" ng-submit="gameCtrl.triggerEpidemic()">
                <input ng-model="gameCtrl.epidemicSearch" class="epidemic__search__input" type="text" />
                <button class="epidemic__search__button" type="submit"></button>
            </form>
        </div>
    </div>
{% endblock %}
